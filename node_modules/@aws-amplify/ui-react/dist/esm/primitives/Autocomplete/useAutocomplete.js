import*as e from"react";import{ARROW_UP as t,ARROW_DOWN as n,ENTER_KEY as o,ESCAPE_KEY as l}from"../shared/constants.js";import{isFunction as s}from"../shared/utils.js";import{useStableId as i}from"../utils/useStableId.js";const c=new Set([n,t,o,l]),u=({defaultValue:u="",value:a,options:d,optionFilter:r,onBlur:m,onChange:f,onClear:h,onClick:p,onFocus:g,onSelect:b,onSubmit:C})=>{const I=void 0!==a,[k,v]=e.useState(u),O=I?a:k,[B,E]=e.useState(!1),[w,y]=e.useState(null),S=s(r),T=e.useMemo((()=>{const e=S?e=>r(e,O):e=>{const{label:t}=e;return null==t?void 0:t.includes(O)};return(null==d?void 0:d.filter(e))||[]}),[O,r,S,d]),H=i(),F=i(),M=i(),V=i(),j=T.findIndex((e=>e===w)),x=(null==w?void 0:w.id)||(-1!==j?`${V}-option-${j}`:void 0),D=e.useCallback((e=>{E(!1),y(null),s(m)&&m(e)}),[m]),R=e.useCallback((e=>{y(null),E(!0),I||v(e.target.value),s(f)&&f(e)}),[I,f]),$=e.useCallback((()=>{I||v(""),s(h)&&h()}),[I,h]),A=e.useCallback((e=>{E(!0),s(p)&&p(e)}),[p]),K=e.useCallback((e=>{E(!0),s(g)&&g(e)}),[g]);return e.useEffect((()=>{const e=document.getElementById(H),t=document.getElementById(M);if(t&&B){const{bottom:n}=t.getBoundingClientRect(),{offsetParent:o,offsetTop:l}=e;o===document.body&&n>document.documentElement.clientHeight&&window.scrollTo({top:Math.min(n-document.documentElement.clientHeight+window.scrollY+20,l),behavior:"smooth"})}}),[H,B,M]),e.useEffect((()=>{const e=document.getElementById(F),t=document.getElementById(x);if(t&&e){const{scrollTop:n,clientHeight:o}=e,{offsetHeight:l,offsetTop:s}=t,{top:i,bottom:c}=t.getBoundingClientRect();n>s&&(e.scrollTop=s),n+o<s+l&&(e.scrollTop=s+l-o),(i<0||c>document.documentElement.clientHeight)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[x,F]),{activeOptionId:x,autocompleteId:H,composedValue:O,filteredOptions:T,handleOnBlur:D,handleOnClear:$,handleOnClick:A,handleOnFocus:K,handleOnChange:R,handleOnKeyDown:e=>{const{key:i}=e;if(c.has(i))switch(e.preventDefault(),i){case l:B?(E(!1),y(null)):$();break;case o:if(w){const{label:e}=w;I||v(e),s(b)&&b(w)}else s(C)&&C(O);E(!1),y(null);break;case n:{if(T.length<=0)return;E(!0);const e=j>=T.length-1?0:j+1;y(T[e]);break}case t:{if(T.length<=0)return;E(!0);const e=j<=0?T.length-1:j-1;y(T[e])}}},isControlled:I,isCustomFiltering:S,isMenuOpen:B,listboxId:F,menuId:M,optionBaseId:V,setActiveOption:y,setIsMenuOpen:E,setInternalValue:v}};export{u as useAutocomplete};
